<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">
	<select id="getLoginUser" parameterType="users" resultType="users">
		SELECT *
		FROM tb_user
		WHERE id = #{id} AND pw = #{pw} AND yn = 'Y'
	</select>
	
	<select id="getUser" parameterType="string" resultType="int" >
		SELECT COUNT(*) AS ccnt
		FROM tb_user
		WHERE id = #{value} AND yn = 'Y'
	
	</select>
	
	<select id="getDeleteUser" parameterType="string" resultType="int" >
		SELECT COUNT(*) AS ccnt
		FROM tb_user
		WHERE id = #{value} AND yn = 'N'
	
	</select>
	
	
	
	
	<insert id="userSave" parameterType="users" statementType="CALLABLE">
		{call sp_user_set(#{id},#{pw},#{name},#{position})}
	</insert>


	<insert id="userRegister" parameterType="users" statementType="CALLABLE">
		{CALL sp_user_set(#{id},#{pw},#{name},#{position},#{query_gb})}
	</insert>

	<insert id="userModify" parameterType="users" statementType="CALLABLE">
		{CALL sp_user_set(#{id},#{pw},#{name},#{position},#{query_gb})}
	</insert>
 
	<insert id="userActivation" parameterType="users" statementType="CALLABLE">
		{CALL sp_user_set(#{id},#{pw},#{name},#{position},#{query_gb})}
	</insert>
 
 
	<select id="getUserListDetail" resultType="users" parameterType="users">
		SELECT *, repeat('*',LENGTH(pw)) AS view_pw
		FROM tb_user
		WHERE yn = 'Y'
			<if test="name != '' and name != null">
				AND name = #{name}
			</if>
		ORDER BY id
	</select>
	
	<select id="getUserListDetailCount" resultType = "int" parameterType="users">
		SELECT COUNT(*) AS count
		FROM tb_user
		WHERE yn = 'Y'
	</select>
	
	<select id="getUserSelectOne" resultType="users" parameterType="string">
		SELECT *
		FROM tb_user
		WHERE id = #{value}
	</select>
	
	<select id="userDelete" parameterType="string">
		SELECT sp_user_delete_set(#{value}) 
	</select>
	
	<select id="getUserListSelectTag" resultType="string">
		SELECT DISTINCT name
		FROM tb_user
		WHERE yn='Y'
	</select>
		
	<select id="getUserPwChangeChk" parameterType="map" resultType="int">
		SELECT COUNT(*)
		FROM tb_user
		WHERE yn = 'Y' AND id = #{n_id} AND pw = #{n_pw}
	</select>
	
	<update id="userPwChange" parameterType="map">
		UPDATE tb_user SET pw = #{c_pw}
		WHERE yn = 'Y' AND id = #{n_id} AND pw = #{n_pw} 
	</update>
</mapper>